{
  "apiInfo": {
    "version": "2.2.0",
    "title": "PDF Translation & RAG API",
    "description": "PDF OCRã€ç¿»è­¯ã€åœ–ç‰‡ç¿»è­¯ã€å¤šæ¨¡æ…‹ RAG èˆ‡ GraphRAG çŸ¥è­˜åœ–è­œæœå‹™ã€‚æ”¯æ´ Flutter æ‰‹æ©Ÿç«¯ã€Web ç«¯èˆ‡ React å‰ç«¯æ•´åˆã€‚",
    "baseUrlExample": "http://localhost:8000",
    "supportedClients": ["Flutter (Mobile/Web)", "React", "ä»»ä½•æ”¯æ´ REST API çš„å‰ç«¯æ¡†æ¶"],
    "lastUpdated": "2025-12-21"
  },

  "authentication": {
    "type": "Bearer Token (Supabase JWT)",
    "header": "Authorization",
    "headerFormat": "Bearer {supabase_access_token}",
    "description": "æ‰€æœ‰å—ä¿è­·çš„ç«¯é»éƒ½éœ€è¦ Supabase JWT Tokenã€‚å‰ç«¯éœ€è¦å…ˆé€é Supabase Auth ç™»å…¥å¾Œå–å¾— access_tokenã€‚",
    "exampleHeader": {
      "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    },
    "notes": [
      "Token éœ€å¾ Supabase Auth ç™»å…¥å¾Œå–å¾—",
      "Flutter: ä½¿ç”¨ supabase_flutter å¥—ä»¶çš„ supabase.auth.currentSession?.accessToken",
      "React: ä½¿ç”¨ @supabase/supabase-js çš„ session.access_token",
      "Token éæœŸéœ€é‡æ–°å–å¾—æˆ–ä½¿ç”¨ refresh_token åˆ·æ–°",
      "é–‹ç™¼æ¨¡å¼ (DEV_MODE=true) å¯è·³éèªè­‰ï¼Œåƒ…ä¾›æ¸¬è©¦ç”¨"
    ],
    "errorResponses": {
      "401": {
        "detail": "Missing Authorization Header | Invalid Authorization Header format | Invalid Token | Authentication Failed"
      },
      "500": {
        "detail": "Authentication service unavailable (Supabase é€£ç·šå•é¡Œ)"
      }
    }
  },

  "endpoints": {
    "health": {
      "path": "/",
      "method": "GET",
      "description": "å¥åº·æª¢æŸ¥ç«¯é»ï¼Œç¢ºèª API æœå‹™æ˜¯å¦æ­£å¸¸é‹ä½œ",
      "authentication": false,
      "request": null,
      "response": {
        "type": "object",
        "example": {
          "message": "Welcome to the PDF Translation & Per-User RAG QA API."
        }
      },
      "flutterExample": "final response = await http.get(Uri.parse('$baseUrl/'));",
      "reactExample": "const response = await fetch(`${baseUrl}/`);"
    },

    "pdfmd": {
      "prefix": "/pdfmd",
      "description": "PDF OCR & ç¿»è­¯æœå‹™",
      "endpoints": {
        "list_documents": {
          "path": "/pdfmd/list",
          "method": "GET",
          "description": "å–å¾—ä½¿ç”¨è€…çš„æ–‡ä»¶åˆ—è¡¨ï¼Œæœ€å¤šè¿”å› 50 ç­†",
          "authentication": true,
          "request": null,
          "response": {
            "type": "DocumentListResponse",
            "example": {
              "documents": [
                {
                  "id": "f6c946b0-aebf-4860-9355-b2880ab9023c",
                  "file_name": "2404.09556v2.pdf",
                  "created_at": "2024-12-19T19:55:30Z",
                  "status": "completed",
                  "processing_step": "indexed"
                }
              ],
              "total": 1
            }
          },
          "flutterExample": {
            "code": "Future<List<DocumentItem>> listDocuments(String accessToken) async {\n  final response = await http.get(\n    Uri.parse('$baseUrl/pdfmd/list'),\n    headers: {'Authorization': 'Bearer $accessToken'},\n  );\n  if (response.statusCode == 200) {\n    final data = jsonDecode(response.body);\n    return (data['documents'] as List).map((e) => DocumentItem.fromJson(e)).toList();\n  }\n  throw Exception('Failed to list documents');\n}"
          },
          "reactExample": {
            "code": "async function listDocuments(accessToken: string): Promise<DocumentListResponse> {\n  const response = await fetch(`${baseUrl}/pdfmd/list`, {\n    headers: { 'Authorization': `Bearer ${accessToken}` },\n  });\n  if (!response.ok) throw new Error('Failed to list');\n  return response.json();\n}"
          },
          "notes": [
            "æœ€å¤šè¿”å› 50 ç­†æ–‡ä»¶",
            "ä¾ä¸Šå‚³æ™‚é–“é™åºæ’åº",
            "æ¬„ä½ file_name ä½¿ç”¨åº•ç·šå‘½å (é filename)"
          ]
        },

        "upload_pdf": {
          "path": "/pdfmd/upload_pdf_md",
          "alternativePath": "/pdfmd/ocr",
          "method": "POST",
          "description": "ä¸Šå‚³ PDF æ–‡ä»¶ï¼Œé€²è¡Œ OCR è¾¨è­˜å¾Œç¿»è­¯æˆç¹é«”ä¸­æ–‡ï¼Œä¸¦åŠ å…¥ RAG çŸ¥è­˜åº«",
          "authentication": true,
          "request": {
            "contentType": "multipart/form-data",
            "parameters": {
              "file": {
                "type": "file",
                "required": true,
                "description": "PDF æª”æ¡ˆ (å¿…é ˆæ˜¯ application/pdf)"
              }
            }
          },
          "response": {
            "type": "FileResponse",
            "contentType": "application/pdf",
            "description": "ç¿»è­¯å¾Œçš„ PDF æª”æ¡ˆ",
            "headers": {
              "Content-Disposition": "attachment; filename=translated_{doc_id}.pdf"
            }
          },
          "pipeline": [
            "1. å„²å­˜ä¸Šå‚³çš„ PDF",
            "2. OCR è¾¨è­˜ (Local Marker - GPU åŠ é€Ÿ)",
            "3. ç¿»è­¯å…§å®¹ç‚ºç¹é«”ä¸­æ–‡ (Gemini LLM)",
            "4. ç”Ÿæˆç¿»è­¯å¾Œçš„ PDF ä¸¦å›å‚³",
            "5. [èƒŒæ™¯] åŠ å…¥ RAG çŸ¥è­˜åº« (FAISS å‘é‡ç´¢å¼•)",
            "6. [èƒŒæ™¯] ç”Ÿæˆæ–‡ä»¶æ‘˜è¦"
          ],
          "errorResponses": {
            "400": "Invalid file type | ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼",
            "500": "OCR failed | Translation failed | PDF generation failed"
          },
          "flutterExample": {
            "code": "Future<Uint8List> uploadPdf(File pdfFile, String accessToken) async {\n  final uri = Uri.parse('$baseUrl/pdfmd/upload_pdf_md');\n  final request = http.MultipartRequest('POST', uri)\n    ..headers['Authorization'] = 'Bearer $accessToken'\n    ..files.add(await http.MultipartFile.fromPath(\n      'file',\n      pdfFile.path,\n      contentType: MediaType('application', 'pdf'),\n    ));\n  \n  final response = await request.send();\n  if (response.statusCode == 200) {\n    return await response.stream.toBytes();\n  }\n  throw Exception('Upload failed: ${response.statusCode}');\n}"
          },
          "reactExample": {
            "code": "async function uploadPdf(file: File, accessToken: string): Promise<Blob> {\n  const formData = new FormData();\n  formData.append('file', file);\n  \n  const response = await fetch(`${baseUrl}/pdfmd/upload_pdf_md`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${accessToken}`,\n    },\n    body: formData,\n  });\n  \n  if (!response.ok) throw new Error(`Upload failed: ${response.status}`);\n  return response.blob();\n}"
          },
          "notes": [
            "è™•ç†æ™‚é–“è¼ƒé•· (è¦– PDF é æ•¸è€Œå®šï¼Œç´„ 30s-5min)ï¼Œå»ºè­°é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨",
            "å¤§æª”æ¡ˆå»ºè­°è¨­å®šè¼ƒé•·çš„ timeout (120ç§’ä»¥ä¸Š)",
            "å›å‚³çš„æ˜¯äºŒé€²ä½ PDF æª”æ¡ˆï¼Œéœ€ç”¨ Blob/Uint8List è™•ç†",
            "åŒæ™‚æ”¯æ´ /pdfmd/upload_pdf_md å’Œ /pdfmd/ocr å…©å€‹è·¯å¾‘"
          ]
        },

        "get_status": {
          "path": "/pdfmd/file/{doc_id}/status",
          "method": "GET",
          "description": "å–å¾—æ–‡ä»¶è™•ç†ç‹€æ…‹ï¼Œç”¨æ–¼å‰ç«¯è¼ªè©¢é¡¯ç¤ºé€²åº¦",
          "authentication": true,
          "request": {
            "pathParameters": {
              "doc_id": {
                "type": "string",
                "format": "uuid",
                "required": true,
                "description": "æ–‡ä»¶çš„ UUID"
              }
            }
          },
          "response": {
            "type": "StatusResponse",
            "example": {
              "step": "translating",
              "step_label": "ç¿»è­¯ä¸­",
              "is_pdf_ready": false,
              "is_fully_complete": false
            }
          },
          "processingSteps": {
            "uploading": "ä¸Šå‚³ä¸­",
            "ocr": "OCR è¾¨è­˜ä¸­",
            "translating": "ç¿»è­¯ä¸­",
            "generating_pdf": "ç”Ÿæˆ PDF ä¸­",
            "completed": "ç¿»è­¯å®Œæˆ (PDF å¯ä¸‹è¼‰)",
            "indexing": "å»ºç«‹ç´¢å¼•ä¸­",
            "indexed": "å…¨éƒ¨å®Œæˆ",
            "failed": "è™•ç†å¤±æ•—"
          }
        },
        
        "get_pdf_file": {
          "path": "/pdfmd/file/{doc_id}",
          "method": "GET",
          "description": "é€éæ–‡ä»¶ ID å–å¾—å·²è™•ç†çš„ PDF æª”æ¡ˆ",
          "authentication": true,
          "request": {
            "pathParameters": {
              "doc_id": {
                "type": "string",
                "format": "uuid",
                "required": true,
                "description": "æ–‡ä»¶çš„ UUID"
              }
            }
          },
          "response": {
            "type": "FileResponse",
            "contentType": "application/pdf",
            "description": "PDF æª”æ¡ˆ"
          },
          "errorResponses": {
            "404": "Document not found | æ–‡ä»¶ä¸å­˜åœ¨æˆ–å·²è¢«åˆªé™¤"
          }
        },
        
        "delete_pdf_file": {
          "path": "/pdfmd/file/{doc_id}",
          "method": "DELETE",
          "description": "åˆªé™¤æ–‡ä»¶åŠå…¶æ‰€æœ‰ç›¸é—œè³‡æ–™ï¼ˆRAG ç´¢å¼•ã€å¯¦é«”æª”æ¡ˆã€è³‡æ–™åº«è¨˜éŒ„ï¼‰",
          "authentication": true,
          "request": {
            "pathParameters": {
              "doc_id": {
                "type": "string",
                "format": "uuid",
                "required": true,
                "description": "æ–‡ä»¶çš„ UUID"
              }
            }
          },
          "response": {
            "type": "object",
            "example": {
              "status": "success",
              "message": "Document deleted successfully"
            }
          }
        },

        "get_summary": {
          "path": "/pdfmd/file/{doc_id}/summary",
          "method": "GET",
          "description": "å–å¾—æ–‡ä»¶çš„ AI ç”Ÿæˆæ‘˜è¦",
          "authentication": true,
          "response": {
            "example": {
              "status": "ready",
              "summary": "æœ¬æ–‡æ¢è¨äº†..."
            }
          },
          "statusValues": {
            "ready": "æ‘˜è¦å·²å°±ç·’",
            "generating": "æ­£åœ¨ç”Ÿæˆä¸­",
            "not_available": "å°šæœªç”Ÿæˆ"
          }
        },

        "regenerate_summary": {
          "path": "/pdfmd/file/{doc_id}/summary/regenerate",
          "method": "POST",
          "description": "é‡æ–°ç”Ÿæˆæ–‡ä»¶æ‘˜è¦",
          "authentication": true,
          "response": {
            "example": {
              "status": "started",
              "message": "Summary regeneration scheduled"
            }
          }
        }
      }
    },

    "rag": {
      "prefix": "/rag",
      "description": "RAG å•ç­”æœå‹™ - åŸºæ–¼ä½¿ç”¨è€…çŸ¥è­˜åº«çš„æ™ºèƒ½å•ç­”",
      "endpoints": {
        "ask_question_get": {
          "path": "/rag/ask",
          "method": "GET",
          "description": "åŸºæœ¬ RAG å•ç­” (ç°¡æ˜“ç‰ˆ)",
          "authentication": true,
          "request": {
            "queryParameters": {
              "question": {
                "type": "string",
                "required": true,
                "description": "è¦å•çš„å•é¡Œ"
              },
              "doc_ids": {
                "type": "string",
                "required": false,
                "description": "é€—è™Ÿåˆ†éš”çš„æ–‡ä»¶ IDï¼Œç”¨æ–¼éæ¿¾æŸ¥è©¢ç¯„åœ",
                "example": "uuid1,uuid2,uuid3"
              }
            }
          },
          "response": {
            "type": "AskResponse",
            "example": {
              "question": "ä»€éº¼æ˜¯æ©Ÿå™¨å­¸ç¿’?",
              "answer": "æ©Ÿå™¨å­¸ç¿’æ˜¯äººå·¥æ™ºæ…§çš„ä¸€å€‹åˆ†æ”¯...",
              "sources": ["doc-uuid-1", "doc-uuid-2"]
            }
          }
        },

        "ask_question_post": {
          "path": "/rag/ask",
          "method": "POST",
          "description": "ä¸Šä¸‹æ–‡æ„ŸçŸ¥å•ç­” (æ¨è–¦) - æ”¯æ´å°è©±æ­·å²ã€é€²éšæª¢ç´¢ç­–ç•¥ã€è©•ä¼°æ¨¡å¼",
          "authentication": true,
          "request": {
            "contentType": "application/json",
            "body": {
              "question": {
                "type": "string",
                "required": true,
                "maxLength": 2000,
                "description": "ä½¿ç”¨è€…å•é¡Œ"
              },
              "doc_ids": {
                "type": "array",
                "items": "string",
                "required": false,
                "description": "é™å®šæŸ¥è©¢çš„æ–‡ä»¶ ID åˆ—è¡¨"
              },
              "history": {
                "type": "array",
                "items": "ChatMessage",
                "required": false,
                "maxItems": 10,
                "description": "å°è©±æ­·å²"
              },
              "enable_hyde": {
                "type": "boolean",
                "default": false,
                "description": "å‡è¨­æ€§æ–‡ä»¶å¢å¼·æª¢ç´¢"
              },
              "enable_multi_query": {
                "type": "boolean",
                "default": false,
                "description": "å¤šé‡æŸ¥è©¢èåˆæª¢ç´¢"
              },
              "enable_reranking": {
                "type": "boolean",
                "default": true,
                "description": "Cross-Encoder é‡æ’åº"
              },
              "enable_evaluation": {
                "type": "boolean",
                "default": false,
                "description": "ğŸ†• å•Ÿç”¨ Self-RAG è©•ä¼°æ¨¡å¼ (å¢åŠ å»¶é²ä½†æä¾›è²¬ä»» AI æŒ‡æ¨™)"
              },
              "enable_graph_rag": {
                "type": "boolean",
                "default": false,
                "description": "ğŸ†• å•Ÿç”¨çŸ¥è­˜åœ–è­œå¢å¼·æª¢ç´¢"
              },
              "graph_search_mode": {
                "type": "string",
                "enum": ["local", "global", "hybrid", "auto"],
                "default": "auto",
                "description": "ğŸ†• åœ–è­œæœå°‹æ¨¡å¼"
              },
              "enable_graph_planning": {
                "type": "boolean",
                "default": false,
                "description": "ğŸ†• å•Ÿç”¨åœ–è­œè¼”åŠ©è¦åŠƒ (Deep Research)"
              }
            },
            "example": {
              "question": "é€™ä»½æ–‡ä»¶çš„çµè«–æ˜¯ä»€éº¼ï¼Ÿ",
              "doc_ids": ["doc-uuid-123"],
              "history": [
                {"role": "user", "content": "é€™ä»½ç ”ç©¶å ±å‘Šçš„ä¸»é¡Œæ˜¯ä»€éº¼ï¼Ÿ"},
                {"role": "assistant", "content": "é€™ä»½ç ”ç©¶å ±å‘Šæ¢è¨æ©Ÿå™¨å­¸ç¿’åœ¨é†«ç™‚è¨ºæ–·ä¸­çš„æ‡‰ç”¨..."}
              ],
              "enable_evaluation": false
            }
          },
          "response": {
            "description": "ç•¶ enable_evaluation=false æ™‚å›å‚³ AskResponseï¼Œå¦å‰‡å›å‚³ EnhancedAskResponse",
            "AskResponse": {
              "example": {
                "question": "...",
                "answer": "...",
                "sources": ["doc-id-1", "doc-id-2"]
              }
            },
            "EnhancedAskResponse": {
              "description": "ğŸ†• è©•ä¼°æ¨¡å¼å›æ‡‰",
              "example": {
                "question": "...",
                "answer": "...",
                "sources": [
                  {
                    "doc_id": "doc-id-1",
                    "filename": "paper_a.pdf",
                    "page": 3,
                    "snippet": "ç›¸é—œæ®µè½å…§å®¹...",
                    "score": 0.85
                  }
                ],
                "metrics": {
                  "faithfulness": "grounded",
                  "confidence_score": 0.85
                }
              }
            }
          },
          "reactExample": {
            "code": "async function askQuestion(\n  question: string,\n  accessToken: string,\n  options?: {\n    docIds?: string[];\n    history?: ChatMessage[];\n    enableEvaluation?: boolean;\n  }\n): Promise<AskResponse | EnhancedAskResponse> {\n  const response = await fetch(`${baseUrl}/rag/ask`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${accessToken}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      question,\n      doc_ids: options?.docIds,\n      history: options?.history,\n      enable_evaluation: options?.enableEvaluation ?? false,\n    }),\n  });\n  if (!response.ok) throw new Error('Ask failed');\n  return response.json();\n}"
          }
        },

        "research_question": {
          "path": "/rag/research",
          "method": "POST",
          "description": "æ·±åº¦ç ”ç©¶æ¨¡å¼ - ä½¿ç”¨ Plan-and-Solve å°‡è¤‡é›œå•é¡Œæ‹†è§£ç‚ºå­ä»»å‹™ï¼Œåˆ†åˆ¥é€²è¡Œ RAG æŸ¥è©¢å¾Œç¶œåˆç­”æ¡ˆ",
          "authentication": true,
          "request": {
            "contentType": "application/json",
            "body": {
              "question": {
                "type": "string",
                "required": true,
                "description": "è¦ç ”ç©¶çš„è¤‡é›œå•é¡Œ"
              },
              "max_subtasks": {
                "type": "integer",
                "required": false,
                "default": 5,
                "description": "æœ€å¤§å­ä»»å‹™æ•¸é‡ (1-10)"
              },
              "enable_reranking": {
                "type": "boolean",
                "required": false,
                "default": true,
                "description": "æ˜¯å¦å•Ÿç”¨é‡æ’åºå„ªåŒ–çµæœ"
              }
            }
          },
          "response": {
            "type": "ResearchResponse",
            "example": {
              "question": "æ¯”è¼ƒæ·±åº¦å­¸ç¿’å’Œå‚³çµ±æ©Ÿå™¨å­¸ç¿’çš„å„ªç¼ºé»",
              "summary": "å…©ç¨®æ–¹æ³•å„æœ‰å„ªç¼ºé»...",
              "detailed_answer": "## æ·±åº¦å­¸ç¿’\nå„ªé»ï¼š...\n## å‚³çµ±æ©Ÿå™¨å­¸ç¿’\nå„ªé»ï¼š...",
              "sub_tasks": [
                {"id": 1, "question": "æ·±åº¦å­¸ç¿’çš„å„ªé»?", "answer": "...", "sources": []}
              ],
              "all_sources": ["doc-1", "doc-2"],
              "confidence": 0.85
            }
          }
        }
      }
    },

    "stats": {
      "prefix": "/stats",
      "description": "ğŸ†• çµ±è¨ˆèˆ‡åˆ†ææœå‹™",
      "endpoints": {
        "dashboard": {
          "path": "/stats/dashboard",
          "method": "GET",
          "description": "å–å¾—ä½¿ç”¨è€…çš„å„€è¡¨æ¿çµ±è¨ˆè³‡æ–™",
          "authentication": true,
          "request": null,
          "response": {
            "type": "DashboardStats",
            "example": {
              "total_queries": 42,
              "accuracy_rate": 0.85,
              "grounded_count": 36,
              "hallucinated_count": 4,
              "uncertain_count": 2,
              "avg_confidence": 0.78,
              "queries_last_7_days": [5, 8, 6, 7, 4, 6, 6],
              "top_documents": [
                {"doc_id": "uuid-1", "filename": null, "query_count": 15}
              ]
            }
          },
          "reactExample": {
            "code": "async function getDashboardStats(accessToken: string): Promise<DashboardStats> {\n  const response = await fetch(`${baseUrl}/stats/dashboard`, {\n    headers: { 'Authorization': `Bearer ${accessToken}` },\n  });\n  if (!response.ok) throw new Error('Failed to get stats');\n  return response.json();\n}"
          },
          "notes": [
            "éœ€å…ˆåŸ·è¡Œ Supabase migration (001_create_query_logs.sql)",
            "ä½¿ç”¨ enable_evaluation=true çš„æŸ¥è©¢æ‰æœƒæœ‰è©•ä¼°æŒ‡æ¨™"
          ]
        }
      }
    },

    "imagemd": {
      "prefix": "/imagemd",
      "description": "åœ–ç‰‡ç¿»è­¯æœå‹™ - åŸåœ°ç¿»è­¯åœ–ç‰‡ä¸­çš„æ–‡å­—",
      "endpoints": {
        "translate_image": {
          "path": "/imagemd/translate_image",
          "method": "POST",
          "description": "è¾¨è­˜åœ–ç‰‡ä¸­çš„æ–‡å­—ä¸¦ç¿»è­¯ï¼Œå°‡ç¿»è­¯å¾Œçš„æ–‡å­—è¦†è“‹å›åŸåœ–ç›¸åŒä½ç½®",
          "authentication": true,
          "request": {
            "contentType": "multipart/form-data",
            "parameters": {
              "file": {
                "type": "file",
                "required": true,
                "allowedTypes": ["image/jpeg", "image/png", "image/webp"],
                "description": "è¦ç¿»è­¯çš„åœ–ç‰‡æª”æ¡ˆ"
              }
            }
          },
          "response": {
            "type": "Image (bytes)",
            "contentType": "image/jpeg",
            "description": "ç¿»è­¯å¾Œçš„åœ–ç‰‡ï¼ˆJPEG æ ¼å¼ï¼‰"
          }
        }
      }
    },

    "multimodal": {
      "prefix": "/multimodal",
      "description": "å¤šæ¨¡æ…‹ RAG æœå‹™ - æå– PDF ä¸­çš„æ–‡å­—å’Œè¦–è¦ºå…ƒç´ ï¼ˆåœ–è¡¨ã€å…¬å¼ï¼‰ä¸¦å»ºç«‹ç´¢å¼•",
      "endpoints": {
        "extract": {
          "path": "/multimodal/extract",
          "method": "POST",
          "description": "å¾ PDF æå–æ–‡å­—å€å¡Šå’Œè¦–è¦ºå…ƒç´ ï¼Œç”¨ Gemini æ‘˜è¦åœ–ç‰‡ï¼Œä¸¦å»ºç«‹ RAG ç´¢å¼•",
          "authentication": true,
          "request": {
            "contentType": "multipart/form-data",
            "parameters": {
              "file": {
                "type": "file",
                "required": true,
                "description": "PDF æª”æ¡ˆ"
              }
            }
          },
          "response": {
            "type": "ExtractedDocument"
          }
        },

        "delete": {
          "path": "/multimodal/file/{doc_id}",
          "method": "DELETE",
          "description": "åˆªé™¤å¤šæ¨¡æ…‹æ–‡ä»¶åŠå…¶æ‰€æœ‰ç›¸é—œè³‡æ–™",
          "authentication": true,
          "response": {
            "example": {
              "status": "success",
              "message": "Multimodal document deleted successfully"
            }
          }
        }
      }
    },

    "graph": {
      "prefix": "/graph",
      "description": "ğŸ†• GraphRAG çŸ¥è­˜åœ–è­œç®¡ç†æœå‹™",
      "endpoints": {
        "get_status": {
          "path": "/graph/status",
          "method": "GET",
          "description": "å–å¾—ä½¿ç”¨è€…çŸ¥è­˜åœ–è­œçš„ç‹€æ…‹è³‡è¨Š",
          "authentication": true,
          "response": {
            "type": "GraphStatusResponse",
            "example": {
              "has_graph": true,
              "node_count": 1250,
              "edge_count": 3400,
              "community_count": 12,
              "pending_resolution": 45,
              "needs_optimization": true,
              "last_updated": "2025-12-21T10:30:00Z"
            }
          }
        },
        "rebuild_graph": {
          "path": "/graph/rebuild",
          "method": "POST",
          "description": "å¼·åˆ¶é‡å»ºçŸ¥è­˜åœ–è­œ (æœƒé‡æ–°å¾æ‰€æœ‰æ–‡ä»¶æŠ½å–å¯¦é«”)",
          "authentication": true,
          "request": {
            "contentType": "application/json",
            "body": {
              "force": {
                "type": "boolean",
                "default": false,
                "description": "å³ä½¿åœ–è­œç‚ºç©ºä¹Ÿå¼·åˆ¶é‡å»º"
              }
            }
          },
          "response": {
            "example": {
              "status": "started",
              "message": "åœ–è­œé‡å»ºå·²é–‹å§‹ï¼Œè«‹ç¨å¾Œæª¢æŸ¥ç‹€æ…‹"
            }
          }
        },
        "optimize_graph": {
          "path": "/graph/optimize",
          "method": "POST",
          "description": "åŸ·è¡Œå¯¦é«”èåˆèˆ‡ç¤¾ç¾¤é‡å»º",
          "authentication": true,
          "request": {
            "contentType": "application/json",
            "body": {
              "regenerate_communities": {
                "type": "boolean",
                "default": true,
                "description": "é‡æ–°ç”Ÿæˆç¤¾ç¾¤æ‘˜è¦"
              }
            }
          },
          "response": {
            "example": {
              "status": "success",
              "message": "å„ªåŒ–å®Œæˆï¼šåˆä½µ 15 å€‹å¯¦é«”ï¼Œå»ºç«‹ 8 å€‹ç¤¾ç¾¤",
              "details": {
                "merges": 15,
                "communities": 8,
                "node_count": 1235
              }
            }
          }
        }
      }
    }
  },

  "schemas": {
    "ChatMessage": {
      "description": "å°è©±è¨Šæ¯",
      "fields": {
        "role": { "type": "enum", "values": ["user", "assistant"], "description": "è§’è‰² (æ³¨æ„ï¼šä¸æ”¯æ´ system)" },
        "content": { "type": "string", "description": "è¨Šæ¯å…§å®¹" }
      }
    },
    "AskResponse": {
      "description": "åŸºæœ¬ RAG å•ç­”å›æ‡‰",
      "fields": {
        "question": { "type": "string", "description": "åŸå§‹å•é¡Œ" },
        "answer": { "type": "string", "description": "AI ç”Ÿæˆçš„ç­”æ¡ˆ" },
        "sources": { "type": "array[string]", "description": "åƒè€ƒçš„æ–‡ä»¶ ID åˆ—è¡¨" }
      }
    },
    "EnhancedAskResponse": {
      "description": "ğŸ†• è©•ä¼°æ¨¡å¼å•ç­”å›æ‡‰",
      "fields": {
        "question": { "type": "string", "description": "åŸå§‹å•é¡Œ" },
        "answer": { "type": "string", "description": "AI ç”Ÿæˆçš„ç­”æ¡ˆ" },
        "sources": { "type": "array[SourceDetail]", "description": "è©³ç´°ä¾†æºè³‡è¨Š" },
        "metrics": { "type": "EvaluationMetrics | null", "description": "è©•ä¼°æŒ‡æ¨™" }
      }
    },
    "SourceDetail": {
      "description": "ğŸ†• è©³ç´°ä¾†æºå¼•ç”¨",
      "fields": {
        "doc_id": { "type": "string", "description": "æ–‡ä»¶ UUID" },
        "filename": { "type": "string | null", "description": "æª”å" },
        "page": { "type": "integer | null", "description": "é ç¢¼" },
        "snippet": { "type": "string", "description": "å¼•ç”¨æ®µè½ (å‰ 200 å­—)" },
        "score": { "type": "number", "range": "0.0-1.0", "description": "ç›¸é—œæ€§åˆ†æ•¸" }
      }
    },
    "EvaluationMetrics": {
      "description": "ğŸ†• è²¬ä»» AI è©•ä¼°æŒ‡æ¨™",
      "fields": {
        "faithfulness": { "type": "enum", "values": ["grounded", "hallucinated", "uncertain"], "description": "ç­”æ¡ˆå¯ä¿¡åº¦" },
        "confidence_score": { "type": "number", "range": "0.0-1.0", "description": "ä¿¡å¿ƒåˆ†æ•¸" }
      }
    },
    "DocumentItem": {
      "description": "ğŸ†• æ–‡ä»¶åˆ—è¡¨é …ç›®",
      "fields": {
        "id": { "type": "string", "description": "æ–‡ä»¶ UUID" },
        "file_name": { "type": "string", "description": "åŸå§‹æª”å (æ³¨æ„ä½¿ç”¨åº•ç·š)" },
        "created_at": { "type": "datetime", "description": "ä¸Šå‚³æ™‚é–“" },
        "status": { "type": "string | null", "description": "è™•ç†ç‹€æ…‹" },
        "processing_step": { "type": "string | null", "description": "è©³ç´°è™•ç†æ­¥é©Ÿ" }
      }
    },
    "DashboardStats": {
      "description": "ğŸ†• å„€è¡¨æ¿çµ±è¨ˆ",
      "fields": {
        "total_queries": { "type": "integer", "description": "ç¸½æŸ¥è©¢æ¬¡æ•¸" },
        "accuracy_rate": { "type": "number", "description": "æº–ç¢ºç‡ (grounded / evaluated)" },
        "grounded_count": { "type": "integer", "description": "æœ‰æ“šå›ç­”æ•¸" },
        "hallucinated_count": { "type": "integer", "description": "å¹»è¦ºå›ç­”æ•¸" },
        "uncertain_count": { "type": "integer", "description": "ç„¡æ³•åˆ¤æ–·æ•¸" },
        "avg_confidence": { "type": "number", "description": "å¹³å‡ä¿¡å¿ƒåˆ†æ•¸" },
        "queries_last_7_days": { "type": "array[integer]", "description": "è¿‘ 7 å¤©æŸ¥è©¢è¶¨å‹¢" },
        "top_documents": { "type": "array[DocumentStat]", "description": "æœ€å¸¸æŸ¥è©¢çš„æ–‡ä»¶" }
      }
    },
    "DocumentStat": {
      "fields": {
        "doc_id": { "type": "string" },
        "filename": { "type": "string | null" },
        "query_count": { "type": "integer" }
      }
    },
    "ResearchResponse": {
      "description": "æ·±åº¦ç ”ç©¶å›æ‡‰",
      "fields": {
        "question": { "type": "string" },
        "summary": { "type": "string", "description": "ç ”ç©¶æ‘˜è¦" },
        "detailed_answer": { "type": "string", "description": "è©³ç´°ç ”ç©¶å ±å‘Š" },
        "sub_tasks": { "type": "array[SubTaskResponse]" },
        "all_sources": { "type": "array[string]" },
        "confidence": { "type": "number", "range": "0.0-1.0" }
      }
    },
    "SubTaskResponse": {
      "fields": {
        "id": { "type": "integer" },
        "question": { "type": "string" },
        "answer": { "type": "string" },
        "sources": { "type": "array[string]" }
      }
    }
  },

  "errorHandling": {
    "httpStatusCodes": {
      "200": "æˆåŠŸ",
      "400": "è«‹æ±‚éŒ¯èª¤ (ç„¡æ•ˆçš„è¼¸å…¥ã€ä¸æ”¯æ´çš„æª”æ¡ˆé¡å‹)",
      "401": "æœªæˆæ¬Š (ç¼ºå°‘æˆ–ç„¡æ•ˆçš„ Token)",
      "403": "ç¦æ­¢å­˜å– (Token æœ‰æ•ˆä½†æ¬Šé™ä¸è¶³)",
      "404": "æ‰¾ä¸åˆ°è³‡æº (æ–‡ä»¶ä¸å­˜åœ¨)",
      "422": "é©—è­‰éŒ¯èª¤ (Pydantic é©—è­‰å¤±æ•—)",
      "500": "ä¼ºæœå™¨éŒ¯èª¤ (è™•ç†å¤±æ•—ã€æœå‹™ä¸å¯ç”¨)"
    },
    "errorResponseFormat": {
      "example": {
        "detail": "Error message describing what went wrong"
      }
    }
  },

  "bestPractices": {
    "react": [
      "ä½¿ç”¨ React Query æˆ– SWR ç®¡ç†ä¼ºæœå™¨ç‹€æ…‹",
      "å»ºç«‹ API client çµ±ä¸€è™•ç† headers å’ŒéŒ¯èª¤",
      "ä½¿ç”¨ TypeScript å®šç¾©å®Œæ•´çš„ API é¡å‹",
      "æª”æ¡ˆä¸Šå‚³æ™‚è¿½è¹¤é€²åº¦",
      "å¯¦ä½œ retry æ©Ÿåˆ¶è™•ç†æš«æ™‚æ€§éŒ¯èª¤"
    ],
    "general": [
      "æ‰€æœ‰è€—æ™‚æ“ä½œéƒ½æ‡‰è¨­å®šé©ç•¶çš„ timeout (å»ºè­° 120 ç§’)",
      "é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨å‘ŠçŸ¥ä½¿ç”¨è€…è™•ç†ä¸­",
      "doc_id æ‡‰å¦¥å–„å„²å­˜ï¼Œç”¨æ–¼å¾ŒçºŒæŸ¥è©¢å’Œåˆªé™¤æ“ä½œ",
      "æ³¨æ„æ¬„ä½å‘½åï¼šfile_name (æœ‰åº•ç·š)ï¼Œé filename"
    ]
  },

  "metadata": {
    "generatedAt": "2025-12-20T16:00:00+08:00",
    "generatedBy": "Antigravity Agent",
    "targetAudience": ["React Developer", "Flutter Developer", "Frontend AI Agent"],
    "language": "zh-TW (ç¹é«”ä¸­æ–‡)"
  }
}
